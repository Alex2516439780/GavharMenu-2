if("undefined"!=typeof window){let e=null,t=null,n=[],a=[],o=null,i={page:1,pageSize:24};!function(){try{const e=/localhost|127\.0\.0\.1/.test(location.hostname),t=new URLSearchParams(location.search).has("debug");e||t||["log","info","debug"].forEach(e=>{try{console[e]=function(){}}catch(e){}})}catch(e){}}();const s="/api";async function login(e,t){try{const n=await fetch(`${s}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}),a=await n.json();if(a.success)return o=a.data.token,localStorage.setItem("admin_token",o),!0;throw new Error(a.error||"–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞")}catch(e){throw e}}function logout(){o=null,localStorage.removeItem("admin_token"),showLoginModal()}function isAuthenticated(){return null!==o}async function apiRequest(e,t={}){let n=`${s}${e}`;const a={headers:{"Content-Type":"application/json",...t.headers},cache:"no-store",...t};"GET"!==(a.method||"GET").toUpperCase()||/([?&])_t=/.test(n)||(n+=(n.includes("?")?"&":"?")+`_t=${Date.now()}`),o&&(a.headers.Authorization=`Bearer ${o}`);const i=await fetch(n,a);let c={};try{c=await i.json()}catch(e){}if(401===i.status||403===i.status)throw o=null,localStorage.removeItem("admin_token"),"function"==typeof showLoginModal&&showLoginModal(),new Error(c&&c.error||"–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω. –í–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.");if(!i.ok)throw new Error(c&&c.error||`HTTP error! status: ${i.status}`);return c}async function loadDishes(){try{const e=document.getElementById("categorySelect")?.value||"";let t="/dishes?restaurant=true";e&&(t+=`&category=${encodeURIComponent(e)}`),t+=(t.includes("?")?"&":"?")+"light=1";const a=i.pageSize,o=(i.page-1)*i.pageSize;t+=`&limit=${a}&offset=${o}`;const s=await apiRequest(t);n=s.data||[],0===o&&0===n.length&&s.total>0&&(i.page=1),"number"==typeof s.total?(i.total=s.total,i.pageSize=s.limit||a):i.total=n.length,renderDishes()}catch(e){showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª—é–¥: "+e.message)}}async function loadCategories(){try{const e=await apiRequest("/categories?restaurant=true");a=e.data||[],renderCategories(),updateCategorySelects()}catch(e){showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: "+e.message)}}async function loadSettings(){}function ensureDishesPaginationContainer(){let e=document.getElementById("dishesPagination");if(!e){const t=document.getElementById("dishesList");if(!t||!t.parentElement)return null;e=document.createElement("div"),e.id="dishesPagination",e.className="dishes-pagination",t.parentElement.insertBefore(e,t.nextSibling)}return e}function renderDishesPagination(e){const t=ensureDishesPaginationContainer();if(!t)return;const n=Math.max(1,Math.ceil((i.total||e)/i.pageSize)),a=Math.min(i.page,n);i.page=a;let o=Math.max(1,a-Math.floor(3.5)),s=Math.min(n,o+7-1);o=Math.max(1,Math.min(o,s-7+1));let c='<div class="pager">';c+=`<button class="pager-btn" data-page="prev" ${1===a?"disabled":""}>‚Äπ</button>`;for(let e=o;e<=s;e++)c+=`<button class="pager-btn ${e===a?"active":""}" data-page="${e}">${e}</button>`;c+=`<button class="pager-btn" data-page="next" ${a===n?"disabled":""}>‚Ä∫</button>`,c+="</div>",t.innerHTML=c}function renderDishes(){const e=document.getElementById("dishesList");if(!e)return;e.innerHTML="";const t=n.length,a=Math.max(1,Math.ceil(t/i.pageSize));i.page>a&&(i.page=a);const o=(i.page-1)*i.pageSize,s=Math.min(t,o+i.pageSize),c=n.slice(o,s),r=document.createDocumentFragment(),d=c.length;let l=0;const u=window.requestIdleCallback||function(e){return setTimeout(e,16)};u(function n(a){let o=0;for(;l<d&&o<40&&(!a||a.timeRemaining()>5);){const e=c[l++],t=document.createElement("div");t.className="dish-item";const n=e.name&&e.name.ru?e.name.ru:"",a=e.image||"/ELEMENTS/image 2.png";t.innerHTML=`\n                <div class="dish-item-header">\n                    <div style="display: flex; align-items: center; gap: 15px;">\n                        <img loading="lazy" decoding="async" src="${a}" width="80" height="80" alt="${n}" class="dish-item-image" />\n                        <div class="dish-item-info">\n                            <div class="dish-item-name">${n}</div>\n                            <div class="dish-item-category">${e.categoryName&&e.categoryName.ru?e.categoryName.ru:e.category||""}</div>\n                            <div class="dish-item-price">${null!=e.price?Number(e.price).toLocaleString():""} —Å—É–º</div>\n                            <div class="dish-status ${e.inStock?"in-stock":"out-of-stock"}" style="display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.85em; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 8px;">\n                                ${e.inStock?"–í –Ω–∞–ª–∏—á–∏–∏":"–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏"}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="dish-item-actions">\n                    <button class="action-btn edit-btn" data-action="edit" data-id="${e.id}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>\n                    <button class="action-btn delete-btn" data-action="delete" data-id="${e.id}">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>\n                    <button class="action-btn status-btn ${e.inStock?"":"inactive"}" data-action="toggle" data-id="${e.id}">\n                        ${e.inStock?"üëÅÔ∏è –°–∫—Ä—ã—Ç—å":"üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å"}\n                    </button>\n                </div>`,r.appendChild(t),o++}l<d?u(n):(e.appendChild(r),renderDishesPagination(t))})}function renderCategories(){const e=document.getElementById("categoriesList");if(!e)return;e.innerHTML="";const t=document.createDocumentFragment();for(let e=0;e<a.length;e++){const n=a[e],o=document.createElement("div");o.className="category-item";const i=n.name&&n.name.ru?n.name.ru:"",s=Array.isArray(n.subcategories)?n.subcategories.length:0;o.innerHTML=`\n            <div class="category-info">\n                <h3>${i}</h3>\n                <p class="category-key">–ö–ª—é—á: ${n.key}</p>\n                <p class="category-subcategories">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏: ${s}</p>\n                <p class="category-alcohol ${n.isAlcoholic?"alcoholic":"non-alcoholic"}">\n                    ${n.isAlcoholic?"–ê–ª–∫–æ–≥–æ–ª—å–Ω–∞—è":"–ë–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω–∞—è"}\n                </p>\n            </div>\n            <div class="category-actions">\n                <button class="action-btn edit-btn" data-action="edit-category" data-id="${n.id}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>\n                <button class="action-btn delete-btn" data-action="delete-category" data-id="${n.id}">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>\n            </div>`,t.appendChild(o)}e.appendChild(t)}function updateCategorySelects(){document.querySelectorAll("#dishCategory, #categorySelect").forEach(e=>{const t=e.value;"categorySelect"===e.id?e.innerHTML='<option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>':e.innerHTML='<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>',a.forEach(t=>{const n=document.createElement("option");n.value=t.key,n.textContent=t.name.ru,e.appendChild(n)}),[...e.options].some(e=>e.value===t)&&(e.value=t)})}async function saveDish(e){try{const t=await apiRequest("/dishes",{method:"POST",body:JSON.stringify(e)});if(!t.success)throw new Error(t.error||"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±–ª—é–¥–∞");showSuccess("–ë–ª—é–¥–æ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ"),loadDishes(),closeDishModal()}catch(e){showError("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –±–ª—é–¥–∞: "+e.message)}}async function updateDish(e,t){try{const n=await apiRequest(`/dishes/${e}`,{method:"PUT",body:JSON.stringify(t)});if(!n.success)throw new Error(n.error||"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–ª—é–¥–∞");showSuccess("–ë–ª—é–¥–æ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ"),loadDishes(),closeDishModal()}catch(e){showError("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–ª—é–¥–∞: "+e.message)}}async function deleteDish(e){if(confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –±–ª—é–¥–æ?"))try{const t=await apiRequest(`/dishes/${e}`,{method:"DELETE"});if(!t.success)throw new Error(t.error||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –±–ª—é–¥–∞");showSuccess("–ë–ª—é–¥–æ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ"),loadDishes()}catch(e){showError("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –±–ª—é–¥–∞: "+e.message)}}async function toggleDishStatus(e,t){let a=!1;const o=t||document.querySelector(`.status-btn[data-id="${e}"]`),i=o?o.closest(".dish-item"):null,s=i?i.querySelector(".dish-status"):null,c=!!o&&o.classList.contains("inactive"),r=c;o&&s&&(o.classList.toggle("inactive",!r),o.textContent=r?"üëÅÔ∏è –°–∫—Ä—ã—Ç—å":"üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å",s.classList.toggle("in-stock",r),s.classList.toggle("out-of-stock",!r),s.textContent=r?"–í –Ω–∞–ª–∏—á–∏–∏":"–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏");try{const t=await apiRequest(`/dishes/${e}/toggle-status`,{method:"PATCH"});if(!t.success)throw new Error(t.error||"–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞");{const a=n.findIndex(t=>t.id===e);-1!==a&&(n[a].inStock=!!t.data.inStock),showSuccess("–ë–ª—é–¥–æ "+(t.data.inStock?"–ø–æ–∫–∞–∑–∞–Ω–æ":"—Å–∫—Ä—ã—Ç–æ")),localStorage.setItem("gavhar_data_updated",Date.now().toString())}}catch(e){a=!0,o&&s&&(o.classList.toggle("inactive",c),o.textContent=c?"üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å":"üëÅÔ∏è –°–∫—Ä—ã—Ç—å",s.classList.toggle("in-stock",!c),s.classList.toggle("out-of-stock",c),s.textContent=c?"–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏":"–í –Ω–∞–ª–∏—á–∏–∏"),showError("–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: "+e.message)}}async function saveCategory(e){try{const t=await apiRequest("/categories",{method:"POST",body:JSON.stringify(e)});if(!t.success)throw new Error(t.error||"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏");showSuccess("–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞"),loadCategories(),closeCategoryModal()}catch(e){showError("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: "+e.message)}}async function updateCategory(e,t){try{const n=await apiRequest(`/categories/${e}`,{method:"PUT",body:JSON.stringify(t)});if(!n.success)throw new Error(n.error||"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏");showSuccess("–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞"),loadCategories(),closeCategoryModal()}catch(e){showError("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: "+e.message)}}async function deleteCategory(e){if(confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é?"))try{const t=await apiRequest(`/categories/${e}`,{method:"DELETE"});if(!t.success)throw new Error(t.error||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏");showSuccess("–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞"),loadCategories()}catch(e){showError("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: "+e.message)}}async function saveSettings(){}function showLoginModal(){document.getElementById("loginModal").style.display="flex",document.getElementById("adminContainer").style.display="none"}function hideLoginModal(){document.getElementById("loginModal").style.display="none",document.getElementById("adminContainer").style.display="block"}function showDishModal(t=null){e=t;const n=document.getElementById("dishModal"),a=document.getElementById("modalTitle");clearDishForm(),t?(a.textContent="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–ª—é–¥–æ",setTimeout(()=>{loadDishForEdit(t)},50)):a.textContent="–î–æ–±–∞–≤–∏—Ç—å –±–ª—é–¥–æ",n&&(n.style.display="flex",n.classList.add("active"))}function closeDishModal(){document.getElementById("dishModal").style.display="none",e=null,clearDishForm()}function showCategoryModal(e=null){t=e;const n=document.getElementById("categoryModal"),a=document.getElementById("categoryModalTitle");e?(a.textContent="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é",loadCategoryForEdit(e)):(a.textContent="–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é",clearCategoryForm()),n&&(n.style.display="flex",n.classList.add("active"))}function closeCategoryModal(){document.getElementById("categoryModal").style.display="none",t=null}function clearDishForm(){document.getElementById("dishForm").reset();const e=document.getElementById("mainImagePreview"),t=document.getElementById("galleryPreview");e&&(e.innerHTML=""),t&&(t.innerHTML=""),window.currentMainImage=null,window.currentGalleryImages=[];const n=document.getElementById("dishImageFile"),a=document.getElementById("dishImagesFiles");n&&(n.value=""),a&&(a.value="")}function clearCategoryForm(){document.getElementById("categoryForm").reset(),document.getElementById("subcategoriesManager").innerHTML=""}function editDish(e){showDishModal(e)}function editCategory(e){showCategoryModal(e)}async function loadDishForEdit(e){try{const t=n.find(t=>t.id===e);if(!t)return;if(document.getElementById("dishNameRu").value=t.name.ru,document.getElementById("dishNameUz").value=t.name.uz,document.getElementById("dishNameEn").value=t.name.en,document.getElementById("dishCategory").value=t.category,document.getElementById("dishPrice").value=t.price,document.getElementById("dishOrder").value=void 0!==t.order?t.order:1,document.getElementById("dishWeight").value=t.weight||"",document.getElementById("dishTime").value=t.cookingTime||"",document.getElementById("dishCompositionRu").value=t.composition.ru||"",document.getElementById("dishCompositionUz").value=t.composition.uz||"",document.getElementById("dishCompositionEn").value=t.composition.en||"",document.getElementById("dishInStock").checked=t.inStock,document.getElementById("dishIsAlcoholic").checked=t.isAlcoholic,updateSubcategorySelect(t.category),setTimeout(()=>{const e=document.getElementById("dishSubcategory");e&&t.subcategory&&(e.value=t.subcategory)},100),t.image){const e={url:t.image,originalName:"Existing image",filename:t.image.split("/").pop()};window.currentMainImage=e,updateMainImagePreview(e)}if(t.images&&t.images.length>0){const e=t.images.map(e=>({url:e,originalName:"Existing image",filename:e.split("/").pop()}));window.currentGalleryImages=e,updateGalleryImagesPreview([])}}catch(e){showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±–ª—é–¥–∞")}}async function loadCategoryForEdit(e){try{const t=a.find(t=>t.id===e);if(!t)return;document.getElementById("categoryNameRu").value=t.name.ru,document.getElementById("categoryNameUz").value=t.name.uz,document.getElementById("categoryNameEn").value=t.name.en,document.getElementById("categoryKey").value=t.key,document.getElementById("categoryIsAlcoholic").checked=t.isAlcoholic,loadSubcategoriesForEdit(t.subcategories)}catch(e){showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–∏")}}function updateSubcategorySelect(e){const t=document.getElementById("dishSubcategory");t.innerHTML='<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>';const n=a.find(t=>t.key===e);n&&n.subcategories&&n.subcategories.forEach(e=>{const n=document.createElement("option");n.value=e.key,n.textContent=e.name.ru,t.appendChild(n)})}function loadSubcategoriesForEdit(e){document.getElementById("subcategoriesManager").innerHTML="",e.forEach((e,t)=>{addSubcategoryRow(e,t)})}function addSubcategoryRow(e=null,t=0){const n=document.getElementById("subcategoriesManager"),a=document.createElement("div");a.className="subcategory-row",a.innerHTML=`\n        <input type="text" placeholder="–ö–ª—é—á –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏" value="${e?.key||""}" class="subcategory-key" />\n        <input type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (RU)" value="${e?.name?.ru||""}" class="subcategory-name-ru" />\n        <input type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (UZ)" value="${e?.name?.uz||""}" class="subcategory-name-uz" />\n        <input type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (EN)" value="${e?.name?.en||""}" class="subcategory-name-en" />\n        <button type="button" class="remove-subcategory-btn" data-action="remove-subcategory">√ó</button>\n    `,n.appendChild(a)}function removeSubcategoryRow(e){e.parentElement.remove()}async function uploadImage(e,t=!1){try{const t=new FormData;t.append("image",e);const n=await fetch("/api/upload/single",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("admin_token")}`},body:t}),a=await n.json();if(a.success)return a.data;throw new Error(a.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞")}catch(e){return showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: "+e.message),null}}async function uploadImages(e){try{const t=new FormData;Array.from(e).forEach(e=>{t.append("images",e)});const n=await fetch("/api/upload/multiple",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("admin_token")}`},body:t}),a=await n.json();if(a.success)return a.data;throw new Error(a.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤")}catch(e){return showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: "+e.message),[]}}async function handleMainImageUpload(e){const t=e.target.files[0];if(t)if(t.size>15728640)showError("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 15MB");else if(t.type.startsWith("image/"))try{showNotification("–ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...","info");const e=await uploadImage(t,!0);e?(updateMainImagePreview(e),showSuccess("–û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ")):showError("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ")}catch(e){showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: "+e.message)}else showError("–†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è")}async function handleGalleryImagesUpload(e){const t=e.target.files;if(t&&0!==t.length){for(let e of t){if(e.size>15728640)return void showError(`–§–∞–π–ª ${e.name} —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 15MB`);if(!e.type.startsWith("image/"))return void showError(`–§–∞–π–ª ${e.name} –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º`)}try{showNotification("–ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–∞–ª–µ—Ä–µ–∏...","info");const e=await uploadImages(t);e.length>0&&(updateGalleryImagesPreview(e),showSuccess(`${e.length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω–æ –≤ –≥–∞–ª–µ—Ä–µ—é`))}catch(e){showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≥–∞–ª–µ—Ä–µ–∏")}}}function updateMainImagePreview(e){const t=document.getElementById("mainImagePreview");t&&(t.innerHTML=`\n        <div class="preview-item main-preview">\n            <img src="${e.url}" alt="–û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" style="width: 150px; height: 150px; object-fit: cover;">\n            <button type="button" class="remove-image-btn" data-action="remove-main-image">√ó</button>\n            <div class="preview-filename">${e.originalName}</div>\n        </div>\n    `,window.currentMainImage=e)}function updateGalleryImagesPreview(e){const t=document.getElementById("galleryPreview");t&&(window.currentGalleryImages||(window.currentGalleryImages=[]),e&&e.length>0&&window.currentGalleryImages.push(...e),t.innerHTML=window.currentGalleryImages.map((e,t)=>`\n        <div class="preview-item">\n            <img src="${e.url}" alt="–ì–∞–ª–µ—Ä–µ—è ${t+1}" style="width: 100px; height: 100px; object-fit: cover;">\n            <button type="button" class="remove-image-btn" data-action="remove-gallery-image" data-index="${t}">√ó</button>\n            <div class="preview-filename">${e.originalName}</div>\n        </div>\n    `).join(""))}function removeMainImage(){const e=document.getElementById("mainImagePreview");e&&(e.innerHTML=""),window.currentMainImage=null;const t=document.getElementById("dishImageFile");t&&(t.value="")}function removeGalleryImage(e){window.currentGalleryImages&&window.currentGalleryImages[e]&&(window.currentGalleryImages.splice(e,1),updateGalleryImagesPreview([]))}function showSection(e){document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")}),document.getElementById(e+"Section").classList.add("active"),document.querySelectorAll(".nav-btn").forEach(e=>{e.classList.remove("active")}),document.querySelector(`[data-section="${e}"]`).classList.add("active")}async function loadData(){await Promise.all([loadDishes(),loadCategories()])}function showSuccess(e){showNotification(e,"success")}function showError(e){showNotification(e,"error")}function showNotification(e,t="info"){const n=document.querySelector(".notification");n&&n.remove();const a=document.createElement("div");a.className=`notification notification-${t}`,a.innerHTML=`\n        <div class="notification-content">\n            <span class="notification-icon">${"success"===t?"‚úÖ":"error"===t?"‚ùå":"‚ÑπÔ∏è"}</span>\n            <span class="notification-message">${e}</span>\n            <button class="notification-close" data-action="close-notification">√ó</button>\n        </div>\n    `,a.style.cssText=`\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        z-index: 10000;\n        background: ${"success"===t?"#27ae60":"error"===t?"#e74c3c":"#3498db"};\n        color: white;\n        padding: 15px 20px;\n        border-radius: 10px;\n        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);\n        animation: slideIn 0.3s ease;\n        max-width: 400px;\n    `,document.body.appendChild(a),setTimeout(()=>{a.parentElement&&(a.style.animation="slideOut 0.3s ease",setTimeout(()=>a.remove(),300))},5e3)}if(document.addEventListener("DOMContentLoaded",function(){const a=localStorage.getItem("admin_token");a?(o=a,hideLoginModal(),loadData()):showLoginModal(),document.getElementById("loginForm").addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("username").value,n=document.getElementById("password").value;try{await login(t,n),hideLoginModal(),loadData()}catch(e){showError("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: "+e.message)}}),document.getElementById("logoutBtn").addEventListener("click",logout),document.getElementById("refreshMenuBtn").addEventListener("click",function(){localStorage.setItem("gavhar_data_updated",Date.now().toString()),window.open("menu.html","_blank"),showSuccess("–ú–µ–Ω—é –æ–±–Ω–æ–≤–ª–µ–Ω–æ! –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π.")}),document.querySelectorAll(".nav-btn").forEach(e=>{e.addEventListener("click",function(){showSection(this.dataset.section)})});const s=document.getElementById("categorySelect");if(s){const e=debounce(function(){loadDishes()},200);s.addEventListener("change",e)}document.getElementById("dishForm").addEventListener("submit",async function(t){t.preventDefault();const n={name:{ru:document.getElementById("dishNameRu").value,uz:document.getElementById("dishNameUz").value,en:document.getElementById("dishNameEn").value},category:document.getElementById("dishCategory").value,subcategory:document.getElementById("dishSubcategory").value,price:parseInt(document.getElementById("dishPrice").value),order:parseInt(document.getElementById("dishOrder").value)||1,weight:document.getElementById("dishWeight").value,cookingTime:document.getElementById("dishTime").value,composition:{ru:document.getElementById("dishCompositionRu").value,uz:document.getElementById("dishCompositionUz").value,en:document.getElementById("dishCompositionEn").value},inStock:document.getElementById("dishInStock").checked,isAlcoholic:document.getElementById("dishIsAlcoholic").checked,image:window.currentMainImage?window.currentMainImage.url:null,images:window.currentGalleryImages?window.currentGalleryImages.map(e=>e.url):[]};e?await updateDish(e,n):await saveDish(n)}),document.getElementById("categoryForm").addEventListener("submit",async function(e){e.preventDefault();const n=[];document.querySelectorAll(".subcategory-row").forEach(e=>{const t=e.querySelector(".subcategory-key").value,a=e.querySelector(".subcategory-name-ru").value,o=e.querySelector(".subcategory-name-uz").value,i=e.querySelector(".subcategory-name-en").value;t&&a&&o&&i&&n.push({key:t,name:{ru:a,uz:o,en:i}})});const a={key:document.getElementById("categoryKey").value,name:{ru:document.getElementById("categoryNameRu").value,uz:document.getElementById("categoryNameUz").value,en:document.getElementById("categoryNameEn").value},isAlcoholic:document.getElementById("categoryIsAlcoholic").checked,subcategories:n};t?await updateCategory(t,a):await saveCategory(a)}),document.getElementById("closeDishModal").addEventListener("click",closeDishModal),document.getElementById("closeCategoryModal").addEventListener("click",closeCategoryModal),document.getElementById("cancelDishBtn").addEventListener("click",closeDishModal),document.getElementById("cancelCategoryBtn").addEventListener("click",closeCategoryModal),document.getElementById("addDishBtn").addEventListener("click",()=>showDishModal()),document.getElementById("addCategoryBtn").addEventListener("click",()=>showCategoryModal()),document.getElementById("addSubcategoryBtn").addEventListener("click",()=>addSubcategoryRow()),document.getElementById("dishCategory").addEventListener("change",function(){updateSubcategorySelect(this.value)});const c=document.getElementById("dishImageFile"),r=document.getElementById("dishImagesFiles");c&&c.addEventListener("change",handleMainImageUpload),r&&r.addEventListener("change",handleGalleryImagesUpload),document.addEventListener("click",function(e){if(e.target.matches("[data-action]")){const t=e.target.dataset.action,n=parseInt(e.target.dataset.id),a=parseInt(e.target.dataset.index);switch(t){case"edit":editDish(n);break;case"delete":deleteDish(n);break;case"toggle":toggleDishStatus(n,e.target);break;case"edit-category":editCategory(n);break;case"delete-category":deleteCategory(n);break;case"remove-subcategory":removeSubcategoryRow(e.target);break;case"remove-main-image":removeMainImage();break;case"remove-gallery-image":removeGalleryImage(a);break;case"close-notification":e.target.closest(".notification").remove()}}if(e.target.matches("#dishesPagination [data-page]")){const t=e.target.getAttribute("data-page"),a=Math.max(1,Math.ceil(n.length/i.pageSize));if("prev"===t&&i.page>1)i.page-=1,renderDishes();else if("next"===t&&i.page<a)i.page+=1,renderDishes();else{const e=parseInt(t,10);!isNaN(e)&&e>=1&&e<=a&&e!==i.page&&(i.page=e,renderDishes())}}})}),"undefined"!=typeof document){const c=document.createElement("style");c.textContent="\n        @keyframes slideIn {\n            from { transform: translateX(100%); opacity: 0; }\n            to { transform: translateX(0); opacity: 1; }\n        }\n        @keyframes slideOut {\n            from { transform: translateX(0); opacity: 1; }\n            to { transform: translateX(100%); opacity: 0; }\n        }\n        .notification-content {\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n        .notification-close {\n            background: none;\n            border: none;\n            color: white;\n            font-size: 18px;\n            cursor: pointer;\n            margin-left: auto;\n        }\n        #dishesPagination { display: flex; justify-content: center; margin: 16px 0; }\n        #dishesPagination .pager { display: flex; gap: 6px; }\n        #dishesPagination .pager-btn {\n            background: #2d5a47; color: #d4af37; border: 2px solid #d4af37;\n            padding: 6px 12px; border-radius: 10px; cursor: pointer; font-weight: 600;\n        }\n        #dishesPagination .pager-btn.active { background: #d4af37; color: #1a3d2e; }\n        #dishesPagination .pager-btn[disabled] { opacity: .5; cursor: default; }\n    ",document.head.appendChild(c)}"undefined"!=typeof window&&(window.editDish=function(e){showDishModal(e)},window.deleteDish=function(e){confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –±–ª—é–¥–æ?")&&apiRequest(`/dishes/${e}`,{method:"DELETE"}).then(e=>{if(!e.success)throw new Error(e.error||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –±–ª—é–¥–∞");showSuccess("–ë–ª—é–¥–æ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ"),loadDishes()}).catch(e=>{showError("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –±–ª—é–¥–∞: "+e.message)})},window.toggleDishStatus=function(e){toggleDishStatus(e,document.querySelector(`.status-btn[data-id="${e}"]`))},window.editCategory=function(e){showCategoryModal(e)},window.deleteCategory=function(e){confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é?")&&apiRequest(`/categories/${e}`,{method:"DELETE"}).then(e=>{if(!e.success)throw new Error(e.error||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏");showSuccess("–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞"),loadCategories()}).catch(e=>{showError("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: "+e.message)})},window.removeSubcategoryRow=function(e){e.parentElement.remove()})}function debounce(e,t){let n;return function(){const a=this,o=arguments;clearTimeout(n),n=setTimeout(function(){e.apply(a,o)},t)}}